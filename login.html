<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - CloudLock Password Manager</title>

  <!-- External Dependencies -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Custom Styles -->
  <link rel="stylesheet" href="styles/main.css?v=3" />
  <link rel="stylesheet" href="styles/animations.css?v=3" />
  <link rel="stylesheet" href="styles/components.css?v=5" />
  <link rel="stylesheet" href="styles/landing.css?v=1" />
  <link rel="stylesheet" href="styles/enhanced-auth.css" />

</head>
<body>
  <!-- Animated Background -->
  <div class="bg-animation">
    <div class="floating-orb" style="width: 200px; height: 200px; top: 10%; left: 10%;"></div>
    <div class="floating-orb" style="width: 150px; height: 150px; top: 70%; left: 80%; animation-delay: -7s;"></div>
    <div class="floating-orb" style="width: 100px; height: 100px; top: 40%; left: 50%; animation-delay: -14s;"></div>
  </div>

  <!-- Navigation -->
  <nav>
    <div class="nav-container">
      <div class="logo">
        <i class="fas fa-shield-alt"></i>
        <span>CloudLock</span>
      </div>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="index.html#features">Features</a>
        <a href="index.html#security">Security</a>
      </div>
    </div>
  </nav>

  <div class="container">
    <div id="auth-container" class="auth-container-enhanced">
      
      <!-- Step Indicator -->
      <div class="auth-steps" id="auth-steps">
        <div class="auth-step active" data-step="1">
          <div class="step-number">1</div>
          <div class="step-label">Credentials</div>
        </div>
        <div class="auth-step-line"></div>
        <div class="auth-step" data-step="2">
          <div class="step-number">2</div>
          <div class="step-label">Verification</div>
        </div>
        <div class="auth-step-line"></div>
        <div class="auth-step" data-step="3">
          <div class="step-number">3</div>
          <div class="step-label">Complete</div>
        </div>
      </div>

      <!-- Main Auth Tabs -->
      <div class="auth-tabs">
        <button class="tab-btn active" onclick="switchTab('login')">Login</button>
        <button class="tab-btn" onclick="switchTab('register')">Register</button>
      </div>

      <!-- ========================================== -->
      <!-- LOGIN FLOW -->
      <!-- ========================================== -->
      
      <div id="login-flow" class="auth-flow">
        
        <!-- Step 1: Email & Password -->
        <div id="login-step-1" class="auth-step-content active">
          <div class="auth-header">
            <h2><i class="fas fa-lock"></i> Secure Login</h2>
            <p>Access your encrypted vault</p>
          </div>

          <form onsubmit="handleLoginStep1(event)">
            <div class="form-group">
              <label for="login-email">
                <i class="fas fa-envelope"></i> Email Address
              </label>
              <input type="email" id="login-email" required placeholder="your.email@example.com" autocomplete="email" />
            </div>

            <div class="form-group">
              <label for="login-password">
                <i class="fas fa-key"></i> Master Password
              </label>
              <div class="password-input-wrapper">
                <input type="password" id="login-password" required placeholder="Enter your master password" autocomplete="current-password" />
                <button type="button" class="password-toggle" onclick="togglePasswordField('login-password', this)">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>

            <div class="form-group checkbox-group">
              <label>
                <input type="checkbox" id="remember-device" />
                <span>Remember this device for 30 days</span>
              </label>
            </div>

            <button type="submit" class="btn btn-full btn-primary" id="login-step-1-btn">
              <i class="fas fa-arrow-right"></i>
              Continue
            </button>
          </form>

          <div class="auth-footer">
            <a href="reset.html">Forgot password?</a>
          </div>

        </div>

        <!-- Step 2: 2FA Verification -->
        <div id="login-step-2" class="auth-step-content">
          <div class="auth-header">
            <h2><i class="fas fa-shield-alt"></i> Two-Factor Authentication</h2>
            <p>Enter your verification code</p>
          </div>

          <!-- 2FA Method Selection -->
          <div class="mfa-methods" id="mfa-methods">
            <!-- Dynamically populated based on user's enabled methods -->
          </div>

          <!-- Authenticator App Code -->
          <div id="mfa-authenticator" class="mfa-method-content" style="display: none;">
            <div class="mfa-icon">
              <i class="fas fa-mobile-alt"></i>
            </div>
            <p>Enter the 6-digit code from your authenticator app</p>
            <form onsubmit="verifyAuthenticatorCode(event)">
              <div class="code-input-group">
                <input type="text" maxlength="1" class="code-digit" data-index="0" />
                <input type="text" maxlength="1" class="code-digit" data-index="1" />
                <input type="text" maxlength="1" class="code-digit" data-index="2" />
                <input type="text" maxlength="1" class="code-digit" data-index="3" />
                <input type="text" maxlength="1" class="code-digit" data-index="4" />
                <input type="text" maxlength="1" class="code-digit" data-index="5" />
              </div>
              <button type="submit" class="btn btn-full btn-primary">
                <i class="fas fa-check"></i> Verify Code
              </button>
            </form>
          </div>

          <!-- SMS/Email Code -->
          <div id="mfa-sms-email" class="mfa-method-content" style="display: none;">
            <div class="mfa-icon">
              <i class="fas fa-envelope"></i>
            </div>
            <p>We've sent a verification code to <strong id="mfa-contact"></strong></p>
            <form onsubmit="verifySMSEmailCode(event)">
              <div class="form-group">
                <input type="text" id="sms-email-code" maxlength="6" placeholder="Enter 6-digit code" class="code-input-large" />
              </div>
              <button type="submit" class="btn btn-full btn-primary">
                <i class="fas fa-check"></i> Verify Code
              </button>
              <button type="button" class="btn btn-full btn-secondary" onclick="resendCode()" id="resend-btn" disabled>
                <i class="fas fa-redo"></i> Resend Code <span id="resend-timer">(60s)</span>
              </button>
            </form>
          </div>

          <!-- Backup Code -->
          <div id="mfa-backup" class="mfa-method-content" style="display: none;">
            <div class="mfa-icon">
              <i class="fas fa-key"></i>
            </div>
            <p>Enter one of your backup codes</p>
            <form onsubmit="verifyBackupCode(event)">
              <div class="form-group">
                <input type="text" id="backup-code" placeholder="XXXX-XXXX-XXXX-XXXX" class="code-input-large" />
              </div>
              <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <span>This backup code will be invalidated after use</span>
              </div>
              <button type="submit" class="btn btn-full btn-primary">
                <i class="fas fa-check"></i> Verify Backup Code
              </button>
            </form>
          </div>

          <div class="auth-footer">
            <a href="#" onclick="showAlternativeMFA(); return false;">
              <i class="fas fa-exchange-alt"></i> Use different method
            </a>
            <a href="#" onclick="goBackToLogin(); return false;">
              <i class="fas fa-arrow-left"></i> Back to login
            </a>
          </div>
        </div>

        <!-- Step 3: Success -->
        <div id="login-step-3" class="auth-step-content">
          <div class="auth-success">
            <div class="success-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <h2>Login Successful!</h2>
            <p>Redirecting to your secure vault...</p>
            <div class="loading-dots">
              <span></span><span></span><span></span>
            </div>
          </div>
        </div>

      </div>

      <!-- ========================================== -->
      <!-- REGISTER FLOW -->
      <!-- ========================================== -->
      
      <div id="register-flow" class="auth-flow" style="display: none;">
        
        <!-- Step 1: Account Details -->
        <div id="register-step-1" class="auth-step-content active">
          <div class="auth-header">
            <h2><i class="fas fa-user-plus"></i> Create Account</h2>
            <p>Set up your secure vault</p>
          </div>

          <form onsubmit="handleRegisterStep1(event)">
            <div class="form-group">
              <label for="reg-name">
                <i class="fas fa-user"></i> Full Name
              </label>
              <input type="text" id="reg-name" required placeholder="John Doe" autocomplete="name" />
            </div>

            <div class="form-group">
              <label for="reg-email">
                <i class="fas fa-envelope"></i> Email Address
              </label>
              <input type="email" id="reg-email" required placeholder="your.email@example.com" autocomplete="email" />
            </div>

            <div class="form-group">
              <label for="reg-password">
                <i class="fas fa-key"></i> Master Password
              </label>
              <div class="password-input-wrapper">
                <input type="password" id="reg-password" required placeholder="Create a strong password" autocomplete="new-password" />
                <button type="button" class="password-toggle" onclick="togglePasswordField('reg-password', this)">
                  <i class="fas fa-eye"></i>
                </button>
              </div>

              <div class="strength-bar-container">
                <div class="strength-bar" id="strengthBar"></div>
              </div>
              <div class="strength-text" id="strengthText"></div>

              <div class="password-requirements">
                <div class="requirements-title">Password Requirements</div>
                <div class="requirement-item" data-requirement="length">
                  <div class="requirement-icon"><i class="fas fa-check"></i></div>
                  <div class="requirement-text">At least 8 characters</div>
                </div>
                <div class="requirement-item" data-requirement="uppercase">
                  <div class="requirement-icon"><i class="fas fa-check"></i></div>
                  <div class="requirement-text">One uppercase letter (A-Z)</div>
                </div>
                <div class="requirement-item" data-requirement="lowercase">
                  <div class="requirement-icon"><i class="fas fa-check"></i></div>
                  <div class="requirement-text">One lowercase letter (a-z)</div>
                </div>
                <div class="requirement-item" data-requirement="number">
                  <div class="requirement-icon"><i class="fas fa-check"></i></div>
                  <div class="requirement-text">One number (0-9)</div>
                </div>
                <div class="requirement-item" data-requirement="special">
                  <div class="requirement-icon"><i class="fas fa-check"></i></div>
                  <div class="requirement-text">One special character (!@#$%^&*)</div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="reg-confirm">
                <i class="fas fa-check-double"></i> Confirm Password
              </label>
              <input type="password" id="reg-confirm" required placeholder="Re-enter your password" autocomplete="new-password" />
            </div>

            <button type="submit" class="btn btn-full btn-primary" id="register-step-1-btn">
              <i class="fas fa-arrow-right"></i>
              Continue
            </button>
          </form>

          <div class="auth-footer">
            Already have an account? <a href="#" onclick="switchTab('login'); return false;">Login here</a>
          </div>
        </div>

        <!-- Step 2: Set Up 2FA -->
        <div id="register-step-2" class="auth-step-content">
          <div class="auth-header">
            <h2><i class="fas fa-shield-alt"></i> Set Up Two-Factor Authentication</h2>
            <p>Add an extra layer of security</p>
          </div>

          <div class="mfa-setup-options">
            <div class="mfa-setup-card" onclick="setupAuthenticator()">
              <div class="mfa-setup-icon">
                <i class="fas fa-mobile-alt"></i>
              </div>
              <h3>Authenticator App</h3>
              <p>Use Google Authenticator, Authy, or similar</p>
              <div class="mfa-badge recommended">
                <i class="fas fa-star"></i> Recommended
              </div>
            </div>

            <div class="mfa-setup-card" onclick="setupSMS()">
              <div class="mfa-setup-icon">
                <i class="fas fa-sms"></i>
              </div>
              <h3>SMS Verification</h3>
              <p>Receive codes via text message</p>
            </div>

            <div class="mfa-setup-card" onclick="setupEmail()">
              <div class="mfa-setup-icon">
                <i class="fas fa-envelope"></i>
              </div>
              <h3>Email Verification</h3>
              <p>Receive codes via email</p>
            </div>
          </div>

          <div class="auth-footer">
            <a href="#" onclick="skipMFA(); return false;">
              Skip for now (not recommended)
            </a>
          </div>
        </div>

        <!-- Step 2a: Authenticator Setup -->
        <div id="register-step-2a" class="auth-step-content">
          <div class="auth-header">
            <h2><i class="fas fa-qrcode"></i> Set Up Authenticator</h2>
            <p>Scan the QR code with your app</p>
          </div>

          <div class="qr-code-container">
            <div class="qr-code-placeholder" id="qr-code">
              <div class="qr-loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Generating QR code...</p>
              </div>
            </div>
          </div>

          <div class="manual-entry-section">
            <button class="btn btn-secondary btn-full" onclick="toggleManualEntry()">
              <i class="fas fa-keyboard"></i> Can't scan? Enter manually
            </button>
            <div id="manual-entry" style="display: none; margin-top: 15px;">
              <div class="manual-entry-code">
                <label>Secret Key:</label>
                <div class="secret-key-display">
                  <code id="secret-key">XXXX XXXX XXXX XXXX</code>
                  <button class="btn-copy-secret" onclick="copySecretKey()">
                    <i class="fas fa-copy"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <form onsubmit="verifyAuthenticatorSetup(event)" style="margin-top: 30px;">
            <div class="form-group">
              <label>Enter the 6-digit code from your app to verify</label>
              <div class="code-input-group">
                <input type="text" maxlength="1" class="code-digit" data-index="0" />
                <input type="text" maxlength="1" class="code-digit" data-index="1" />
                <input type="text" maxlength="1" class="code-digit" data-index="2" />
                <input type="text" maxlength="1" class="code-digit" data-index="3" />
                <input type="text" maxlength="1" class="code-digit" data-index="4" />
                <input type="text" maxlength="1" class="code-digit" data-index="5" />
              </div>
            </div>
            <button type="submit" class="btn btn-full btn-primary">
              <i class="fas fa-check"></i> Verify & Continue
            </button>
          </form>

          <div class="auth-footer">
            <a href="#" onclick="goBackToMFAOptions(); return false;">
              <i class="fas fa-arrow-left"></i> Choose different method
            </a>
          </div>
        </div>

        <!-- Step 2b: SMS Setup -->
        <div id="register-step-2b" class="auth-step-content">
          <div class="auth-header">
            <h2><i class="fas fa-sms"></i> Set Up SMS Verification</h2>
            <p>Enter your phone number</p>
          </div>

          <form onsubmit="setupSMSVerification(event)">
            <div class="form-group">
              <label for="phone-number">
                <i class="fas fa-phone"></i> Phone Number
              </label>
              <input type="tel" id="phone-number" required placeholder="+1 (555) 123-4567" />
            </div>

            <div class="alert alert-info">
              <i class="fas fa-info-circle"></i>
              <span>Standard SMS rates may apply. We'll send you a verification code.</span>
            </div>

            <button type="submit" class="btn btn-full btn-primary">
              <i class="fas fa-paper-plane"></i> Send Verification Code
            </button>
          </form>

          <div class="auth-footer">
            <a href="#" onclick="goBackToMFAOptions(); return false;">
              <i class="fas fa-arrow-left"></i> Choose different method
            </a>
          </div>
        </div>

        <!-- Step 2c: Email Setup -->
        <div id="register-step-2c" class="auth-step-content">
          <div class="auth-header">
            <h2><i class="fas fa-envelope"></i> Set Up Email Verification</h2>
            <p>We'll use your registered email</p>
          </div>

          <div class="email-verification-info">
            <div class="info-card">
              <i class="fas fa-envelope-open-text"></i>
              <p>Verification codes will be sent to:</p>
              <strong id="user-email-display">user@example.com</strong>
            </div>
          </div>

          <form onsubmit="setupEmailVerification(event)">
            <button type="submit" class="btn btn-full btn-primary">
              <i class="fas fa-paper-plane"></i> Send Test Code
            </button>
          </form>

          <div class="auth-footer">
            <a href="#" onclick="goBackToMFAOptions(); return false;">
              <i class="fas fa-arrow-left"></i> Choose different method
            </a>
          </div>
        </div>

        <!-- Step 3: Backup Codes -->
        <div id="register-step-3" class="auth-step-content">
          <div class="auth-header">
            <h2><i class="fas fa-key"></i> Save Your Backup Codes</h2>
            <p>Use these if you lose access to your 2FA method</p>
          </div>

          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <span><strong>Important:</strong> Store these codes in a safe place. Each can only be used once.</span>
          </div>

          <div class="backup-codes-container" id="backup-codes-list">
            <!-- Dynamically generated backup codes -->
          </div>

          <div class="backup-actions">
            <button class="btn btn-secondary" onclick="downloadBackupCodes()">
              <i class="fas fa-download"></i> Download Codes
            </button>
            <button class="btn btn-secondary" onclick="printBackupCodes()">
              <i class="fas fa-print"></i> Print Codes
            </button>
            <button class="btn btn-secondary" onclick="copyBackupCodes()">
              <i class="fas fa-copy"></i> Copy All
            </button>
          </div>

          <div class="form-group checkbox-group" style="margin-top: 25px;">
            <label>
              <input type="checkbox" id="confirm-saved-codes" required />
              <span>I have saved my backup codes in a secure location</span>
            </label>
          </div>

          <button class="btn btn-full btn-primary" onclick="completeRegistration()" id="complete-registration-btn" disabled>
            <i class="fas fa-check"></i> Complete Setup
          </button>
        </div>

        <!-- Step 4: Security Questions -->
        <div id="register-step-4" class="auth-step-content">
          <div class="auth-header">
            <h2><i class="fas fa-question-circle"></i> Security Questions</h2>
            <p>Help us verify your identity for account recovery</p>
          </div>

          <form onsubmit="saveSecurityQuestions(event)">
            <div class="security-questions-enhanced">
              <div class="security-question-item">
                <label>
                  <span class="question-number">1</span>
                  First Security Question
                </label>
                <select id="question1-select" required class="security-question-select">
                  <option value="">-- Select a question --</option>
                  <option value="pet">What was the name of your first pet?</option>
                  <option value="city">In what city were you born?</option>
                  <option value="school">What is the name of your elementary school?</option>
                  <option value="car">What was the make of your first car?</option>
                  <option value="food">What is your favorite food?</option>
                  <option value="teacher">What was your favorite teacher's name?</option>
                </select>
                <input type="text" id="question1" required placeholder="Your answer..." class="security-question-input" />
              </div>

              <div class="security-question-item">
                <label>
                  <span class="question-number">2</span>
                  Second Security Question
                </label>
                <select id="question2-select" required class="security-question-select">
                  <option value="">-- Select a question --</option>
                  <option value="maiden">What is your mother's maiden name?</option>
                  <option value="street">What street did you grow up on?</option>
                  <option value="job">What was your first job?</option>
                  <option value="movie">What is your favorite movie?</option>
                  <option value="book">What is your favorite book?</option>
                  <option value="vacation">Where did you go on your first vacation?</option>
                </select>
                <input type="text" id="question2" required placeholder="Your answer..." class="security-question-input" />
              </div>

              <div class="security-question-item">
                <label>
                  <span class="question-number">3</span>
                  Third Security Question
                </label>
                <select id="question3-select" required class="security-question-select">
                  <option value="">-- Select a question --</option>
                  <option value="nickname">What was your childhood nickname?</option>
                  <option value="friend">What is your best friend's name?</option>
                  <option value="sport">What is your favorite sport?</option>
                  <option value="sibling">What is your oldest sibling's name?</option>
                  <option value="color">What is your favorite color?</option>
                  <option value="hospital">In what hospital were you born?</option>
                </select>
                <input type="text" id="question3" required placeholder="Your answer..." class="security-question-input" />
              </div>
            </div>

            <button type="submit" class="btn btn-full btn-primary">
              <i class="fas fa-arrow-right"></i> Continue
            </button>
          </form>
        </div>

        <!-- Step 5: Success -->
        <div id="register-step-5" class="auth-step-content">
          <div class="auth-success">
            <div class="success-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <h2>Account Created Successfully!</h2>
            <p>Your secure vault is ready</p>
            <div class="success-features">
              <div class="success-feature">
                <i class="fas fa-lock"></i>
                <span>AES-256 Encryption Enabled</span>
              </div>
              <div class="success-feature">
                <i class="fas fa-shield-alt"></i>
                <span>Two-Factor Authentication Active</span>
              </div>
              <div class="success-feature">
                <i class="fas fa-key"></i>
                <span>Backup Codes Saved</span>
              </div>
            </div>
            <div class="loading-dots">
              <span></span><span></span><span></span>
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>

  <!-- Firebase Libraries -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-functions-compat.js"></script>

  <!-- CryptoJS for Encryption -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <!-- QR Code Generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <!-- Application Scripts -->
  <script src="js/config.js"></script>
  <script src="js/firebase-init.js"></script>
  <script src="js/ui-utils.js"></script>
  <script src="js/encryption.js"></script>
  <script src="js/interactive-background.js"></script>
  <script src="js/enhanced-auth.js"></script>

</body>
</html>