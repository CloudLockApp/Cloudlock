<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - CloudLock</title>
    
    <!-- External Dependencies -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles/main.css?v=3">
    <link rel="stylesheet" href="styles/animations.css?v=3">
    <link rel="stylesheet" href="styles/components.css?v=5">
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation">
        <div class="floating-orb" style="width: 200px; height: 200px; top: 10%; left: 10%;"></div>
        <div class="floating-orb" style="width: 150px; height: 150px; top: 70%; left: 80%; animation-delay: -7s;"></div>
        <div class="floating-orb" style="width: 100px; height: 100px; top: 40%; left: 50%; animation-delay: -14s;"></div>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <span>CloudLock</span>
            </div>
            <div>
                <button class="btn btn-danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Dashboard -->
        <div id="dashboard" class="dashboard active">
            <div class="dashboard-header">
                <h1></h1>
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="user-email">user@example.com</span>
                </div>
            </div>

            <!-- Security Status Cards -->
            <div class="security-status">
                <div class="status-card">
                    <h3><i class="fas fa-shield-alt"></i> Zero-Trust Status</h3>
                    <div class="status-indicator status-active">
                        <i class="fas fa-check-circle"></i> Active Protection
                    </div>
                    <p style="margin-top: 10px; opacity: 0.8;">All systems verified</p>
                </div>

                <div class="status-card">
                    <h3><i class="fas fa-lock"></i> Encryption</h3>
                    <div class="status-indicator status-active">
                        <i class="fas fa-check-circle"></i> AES-256 + RSA-4096
                    </div>
                    <p style="margin-top: 10px; opacity: 0.8;">Military-grade encryption active</p>
                </div>

                <div class="status-card">
                    <h3><i class="fas fa-cloud"></i> Multi-Cloud Backup</h3>
                    <div class="status-indicator status-active">
                        <i class="fas fa-check-circle"></i> 3 Clouds Synced
                    </div>
                    <p style="margin-top: 10px; opacity: 0.8;">AWS, Google Cloud, Azure</p>
                </div>

                <div class="status-card">
                    <h3><i class="fas fa-globe"></i> Dark Web Monitor</h3>
                    <div id="dark-web-status" class="status-indicator status-active">
                        <i class="fas fa-check-circle"></i> No Breaches Detected
                    </div>
                    <p style="margin-top: 10px; opacity: 0.8;">Last scan: Just now</p>
                </div>
            </div>

            <!-- Password Vault -->
            <div class="vault-controls">
                <div class="search-box">
                    <input type="text" id="search-passwords" placeholder="Search passwords..." onkeyup="searchPasswords()">
                </div>
                <button class="btn" onclick="openAddPasswordModal()">
                    <i class="fas fa-plus"></i>
                    Add Password
                </button>
                <button class="btn btn-success" onclick="generateSecurePassword()">
                    <i class="fas fa-key"></i>
                    Generate Password
                </button>
            </div>

            <div id="password-list" class="password-grid">
                <!-- Passwords will be loaded here -->
            </div>

            <!-- Self Destruct Panel -->
            <div class="self-destruct-panel">
                <h3><i class="fas fa-bomb"></i> Emergency Self-Destruct</h3>
                <p>In case of emergency, instantly wipe all credentials across all devices and cloud storage.</p>
                <button class="btn btn-danger" onclick="confirmSelfDestruct()">
                    <i class="fas fa-exclamation-triangle"></i>
                    Activate Self-Destruct
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Password Modal -->
    <div id="password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add New Password</h2>
                <button class="close-btn" onclick="closeModal('password-modal')">&times;</button>
            </div>
            <form onsubmit="savePassword(event)">
                <div class="form-group">
                    <label for="site-name">Website/Service Name</label>
                    <input type="text" id="site-name" required placeholder="e.g., Google, Facebook">
                </div>
                <div class="form-group">
                    <label for="site-url">URL</label>
                    <input type="url" id="site-url" placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label for="site-username">Username/Email</label>
                    <input type="text" id="site-username" required placeholder="Your username or email">
                </div>
                <div class="form-group">
                    <label for="site-password">Password</label>
                    <input type="password" id="site-password" required placeholder="Enter password">
                </div>
                <div class="form-group">
                    <label for="site-notes">Notes (Optional)</label>
                    <textarea id="site-notes" rows="3" placeholder="Additional secure notes"></textarea>
                </div>
                <input type="hidden" id="password-id">
                <button type="submit" class="btn btn-full">
                    <i class="fas fa-save"></i>
                    Save Encrypted
                </button>
            </form>
        </div>
    </div>

    <!-- Advanced Password Generator Modal -->
    <div id="password-generator-modal" class="modal">
        <div class="modal-content generator-modal">
            <div class="modal-header">
                <h2><i class="fas fa-key"></i> Advanced Password Generator</h2>
                <button class="close-btn" onclick="closeModal('password-generator-modal')">&times;</button>
            </div>

            <!-- Password Preview -->
            <div class="generator-preview-section">
                <div class="generator-preview" id="generator-preview">
                    Loading...
                </div>
                <div class="generator-strength" id="generator-strength">
                    <i class="fas fa-shield-alt"></i> Strong
                </div>
                <div class="generator-actions">
                    <button class="btn" onclick="updateGeneratorPreview()">
                        <i class="fas fa-sync-alt"></i> Regenerate
                    </button>
                    <button class="btn btn-success" onclick="copyGeneratedPassword()">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                    <button class="btn" onclick="useGeneratedPassword()" style="background: var(--primary);">
                        <i class="fas fa-check"></i> Use This Password
                    </button>
                </div>
            </div>

            <!-- Password Type Selection -->
            <div class="generator-types">
                <h3>Password Type</h3>
                <div class="type-options">
                    <label class="type-option">
                        <input type="radio" name="password-type" value="strong" checked onchange="updateGeneratorPreview()">
                        <div class="option-card">
                            <i class="fas fa-shield-alt"></i>
                            <strong>Strong Random</strong>
                            <span>Maximum security</span>
                        </div>
                    </label>

                    <label class="type-option">
                        <input type="radio" name="password-type" value="memorable" onchange="updateGeneratorPreview()">
                        <div class="option-card">
                            <i class="fas fa-brain"></i>
                            <strong>Memorable</strong>
                            <span>Easy to remember</span>
                        </div>
                    </label>

                    <label class="type-option">
                        <input type="radio" name="password-type" value="passphrase" onchange="updateGeneratorPreview()">
                        <div class="option-card">
                            <i class="fas fa-quote-left"></i>
                            <strong>Passphrase</strong>
                            <span>Word-based</span>
                        </div>
                    </label>

                    <label class="type-option">
                        <input type="radio" name="password-type" value="pin" onchange="updateGeneratorPreview()">
                        <div class="option-card">
                            <i class="fas fa-hashtag"></i>
                            <strong>PIN Code</strong>
                            <span>Numbers only</span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Custom Settings -->
            <div class="generator-settings">
                <h3>Customize</h3>
                
                <div class="setting-group">
                    <label>
                        <span>Length: <strong id="length-value">16</strong></span>
                        <input type="range" min="8" max="32" value="16" 
                               oninput="document.getElementById('length-value').textContent = this.value; updateGeneratorSetting('length', parseInt(this.value))">
                    </label>
                </div>

                <div class="setting-group checkboxes">
                    <label>
                        <input type="checkbox" checked onchange="updateGeneratorSetting('uppercase', this.checked)">
                        <span>Uppercase (A-Z)</span>
                    </label>
                    <label>
                        <input type="checkbox" checked onchange="updateGeneratorSetting('lowercase', this.checked)">
                        <span>Lowercase (a-z)</span>
                    </label>
                    <label>
                        <input type="checkbox" checked onchange="updateGeneratorSetting('numbers', this.checked)">
                        <span>Numbers (0-9)</span>
                    </label>
                    <label>
                        <input type="checkbox" checked onchange="updateGeneratorSetting('symbols', this.checked)">
                        <span>Symbols (!@#$)</span>
                    </label>
                </div>

                <div class="setting-group checkboxes">
                    <label>
                        <input type="checkbox" onchange="updateGeneratorSetting('excludeSimilar', this.checked)">
                        <span>Exclude similar characters (i, l, 1, L, o, 0, O)</span>
                    </label>
                    <label>
                        <input type="checkbox" onchange="updateGeneratorSetting('excludeAmbiguous', this.checked)">
                        <span>Exclude ambiguous symbols ({ } [ ] ( ) / \ ' " ` ~)</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Assistant Chat -->
    <div class="ai-assistant">
        <div id="ai-chat" class="ai-chat">
            <div class="ai-chat-header">
                <h3><i class="fas fa-robot"></i> AI Security Assistant</h3>
            </div>
            <div id="ai-messages" class="ai-chat-messages">
                <div class="ai-message bot">
                    Hello! I'm your AI security assistant. I can help you:
                    <br>• Generate secure passwords
                    <br>• Check for security threats
                    <br>• Analyze password strength
                    <br>• Provide security tips
                </div>
            </div>
            <div class="ai-chat-input">
                <input type="text" id="ai-input" placeholder="Ask me anything..." onkeypress="handleAIChat(event)">
                <button class="btn" onclick="sendAIMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        <button class="ai-toggle" onclick="toggleAIChat()">
            <i class="fas fa-robot"></i>
        </button>
    </div>

    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- CryptoJS for Encryption -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <!-- Application Scripts -->
    <script src="js/config.js"></script>
    <script src="js/firebase-init.js"></script>
    <script src="js/ui-utils.js"></script>
    <script src="js/encryption.js"></script>
    <script src="js/password-manager.js"></script>
    <script src="js/ai-assistant.js"></script>
    <script src="js/security-monitor.js"></script>
    <script src="js/advanced-generator.js"></script>
    <script src="js/interactive-background.js"></script>

    <script>
        let encryptionKey = null;
        let currentUser = null;

        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            firebase.auth().onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    document.getElementById('user-email').textContent = user.email;
                    
                    // Get user's name and show welcome message
                    try {
                        const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
                        const dashboardTitle = document.querySelector('.dashboard-header h1');
                        
                        if (userDoc.exists && userDoc.data().name) {
                            const userName = userDoc.data().name;
                            dashboardTitle.textContent = `Welcome back, ${userName}.`;
                        } else {
                            dashboardTitle.textContent = 'Welcome to Your Secure Vault';
                        }
                    } catch (error) {
                        console.error('Error fetching user data:', error);
                    }
                    
                    // Load passwords
                    loadPasswords();
                } else {
                    // Not logged in, redirect to login
                    window.location.href = 'login.html';
                }
            });
        });

        // Logout function
        async function logout() {
            try {
                await firebase.auth().signOut();
                encryptionKey = null;
                showToast('Logged out successfully', 'success');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Logout failed', 'error');
            }
        }
    </script>
</body>
</html>